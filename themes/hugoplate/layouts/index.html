{{ define "main" }}
  <!-- Banner -->
  {{ with .Params.banner }}
    <section class="section pt-14">
      <div class="container">
        <div class="row justify-center">
          <div class="lg:col-7 md:col-9 mb-8 text-center">
            <h1 class="mb-4 text-h3 lg:text-h1">
              {{ .title | markdownify }}
            </h1>
            <p class="mb-8">
              {{ .content | markdownify }}
            </p>
            {{ $profileImg := resources.Get "images/profile_img.jpg" }}
            <img src="{{ $profileImg.Permalink }}" alt="Profile Image" class="profile-img">
            
            {{ with .button }}
              {{ if .enable }}
                <a
                  class="btn btn-primary"
                  href="{{ .link | absURL }}"
                  {{ if strings.HasPrefix .link `http` }}
                    target="_blank" rel="noopener"
                  {{ end }}>
                  {{ .label }}
                  <i class="fa fa-arrow-right pl-2"></i>
                </a>
              {{ end }}
            {{ end }}
            {{ if .social_links }}
              <div class="social-links mt-6">
                {{ range .social_links }}
                  <a href="{{ .link }}" target="_blank" class="mr-4">
                    <i class="{{ .icon }}"></i>
                  </a>
                {{ end }}
              </div>
            {{ end }}
            {{ if .research_interests }}
              <div class="research-interests mt-8">
                <h3 class="text-xl font-semibold mb-4 text-gray-800 dark:text-gray-200">Research Interests</h3>
                <div class="flex flex-wrap justify-center gap-2">
                  {{ range .research_interests }}
                    <span class="px-3 py-1 bg-primary/8 text-primary dark:bg-neutral-400 dark:text-primary-light rounded-full text-sm font-medium">
                      {{ . }}
                    </span>
                  {{ end }}
                </div>
              </div>
            {{ end }}
            
            <!-- CV Download Button -->
            {{ with .cv_button }}
              {{ if .enable }}
                <div class="mt-6 text-center">
                  <a
                    class="btn btn-outline-primary"
                    href="{{ .link | relURL }}"
                    target="_blank" rel="noopener">
                    <i class="fas fa-download mr-2"></i>
                    {{ .label }}
                  </a>
                </div>
              {{ end }}
            {{ end }}
          </div>
          <!-- <div class="col-12">
            {{ partial "image" (dict "Src" .image "Alt" "Banner image" "Loading" "eager" "Class" "mx-auto lg:!max-w-[800px]" "DisplayXL" "800x" ) }} -->
          <!-- </div> -->
        </div>
      </div>
    </section>
  {{ end }}
  <!-- /Banner -->

  <!-- Features -->
  {{ range $i, $e:= .Params.features }}
    <section class="section-sm {{ if (modBool $i 2) }}bg-gradient{{ end }}">
      <div class="container">
        <div class="row items-center justify-between">
          <div
            class="mb:md-0 {{ if not (modBool $i 2) }}
              md:order-2
            {{ end }} md:col-5 mb-6">
            {{ partial "image" (dict "Src" .image "Alt" "feature image" "DisplayXL" "520x" "DisplayLG" "425x" "DisplayMD" "360x") }}
          </div>
          <div
            class="{{ if not (modBool $i 2) }}
              md:order-1
            {{ end }} md:col-7 lg:col-6">
            <h2 class="mb-4">
              {{ .title | markdownify }}
            </h2>
            <p class="mb-8 text-lg">
              {{ .content | markdownify }}
            </p>
            <ul>
              {{ range .bulletpoints }}
                <li class="relative mb-4 pl-6">
                  <i class="fa fa-check absolute left-0 top-1.5"></i>
                  {{ . | markdownify }}
                </li>
              {{ end }}
            </ul>
            {{ with .button }}
              {{ if .enable }}
                <a class="btn btn-primary mt-6" href="{{ .link | absURL }}">
                  {{ .label }}
                  <i class="fa fa-arrow-right pl-2"></i>
                </a>
              {{ end }}
            {{ end }}
          </div>
        </div>
      </div>
    </section>
  {{ end }}
  <!-- /Features -->

    <!-- Features Without Images -->
  {{ range $i, $e := .Params.features_noimg }}
    <section class="section-sm {{ if (modBool $i 2) }}bg-gradient{{ end }}">
      <div class="container">
        <div class="row justify-center">
          <div class="md:col-8 lg:col-7 text-center">
            <h2 class="mb-4">
              {{ .title | markdownify }}
            </h2>
            <p class="mb-8 text-lg">
              {{ .content | markdownify }}
            </p>
            <ul class="list-none">
              {{ range .bulletpoints }}
                <li class="relative mb-4 pl-6">
                  <i class="fa fa-check absolute left-0 top-1.5"></i>
                  {{ . | markdownify }}
                </li>
              {{ end }}
            </ul>
            {{ with .button }}
              {{ if .enable }}
                <a class="btn btn-primary mt-6" href="{{ .link | absURL }}">
                  {{ .label }}
                  <i class="fa fa-arrow-right pl-2"></i>
                </a>
              {{ end }}
            {{ end }}
          </div>
        </div>
      </div>
    </section>
  {{ end }}
  <!-- /Features Without Images -->

  <!-- Testimonials -->
  {{ with site.GetPage "sections/testimonial" }}
    {{ if .Params.enable }}
      <section class="section">
        <div class="container">
          <div class="row">
            <div class="md:col-10 lg:col-8 xl:col-6 mx-auto mb-12 text-center">
              <h2 class="mb-4">
                {{ .Title | markdownify }}
              </h2>
              <p>
                {{ .Params.description | markdownify }}
              </p>
            </div>
            <div class="col-12">
              <div class="swiper testimonial-slider">
                <div class="swiper-wrapper">
                  {{ range .Params.testimonials }}
                    <div class="swiper-slide">
                      <div
                        class="bg-light dark:bg-darkmode-light rounded-lg px-7 py-10">
                        <div class="text-text-dark dark:text-white">
                          <svg
                            width="33"
                            height="20"
                            viewBox="0 0 33 20"
                            fill="none"
                            xmlns="http://www.w3.org/2000/svg">
                            <path
                              d="M1.28375 19.41L0.79375 18.64C1.21375 17.0067 1.75042 15.07 2.40375 12.83C3.05708 10.5433 3.75708 8.28 4.50375 6.04C5.29708 3.75333 6.06708 1.77 6.81375 0.0899959H15.3538C14.9338 2.09666 14.4904 4.26667 14.0238 6.6C13.5571 8.88666 13.1371 11.15 12.7638 13.39C12.4371 15.5833 12.1571 17.59 11.9238 19.41H1.28375ZM31.69 0.0899959L32.18 0.859998C31.76 2.54 31.2233 4.5 30.57 6.74C29.9167 8.98 29.2167 11.2433 28.47 13.53C27.7233 15.77 26.9533 17.73 26.16 19.41H17.69C18.0167 17.9167 18.3433 16.33 18.67 14.65C18.9967 12.9233 19.3 11.22 19.58 9.54C19.9067 7.81333 20.1867 6.15667 20.42 4.57C20.7 2.93666 20.91 1.44333 21.05 0.0899959H31.69Z"
                              fill="currentColor" />
                          </svg>
                        </div>
                        <blockquote class="mt-8">
                          {{ .content | markdownify }}
                        </blockquote>
                        <div class="mt-11 flex items-center">
                          <div class="text-text-dark dark:text-white">
                            {{ partial "image" (dict "Src" .avatar "Size" "50x50" "Class" "rounded-full" "Alt" .name) }}
                          </div>
                          <div class="ml-4">
                            <h3 class="h5 font-primary font-semibold">
                              {{ .name }}
                            </h3>
                            <p class="text-text-dark dark:text-white">
                              {{ .designation | markdownify }}
                            </p>
                          </div>
                        </div>
                      </div>
                    </div>
                  {{ end }}
                </div>
                <div
                  class="testimonial-slider-pagination mt-9 flex items-center justify-center text-center"></div>
              </div>
            </div>
          </div>
        </div>
      </section>
    {{ end }}
  {{ end }}
  <!-- /Testimonials -->

  <!-- Experience Section -->
  {{ with .Params.experience }}
    <section class="section-sm bg-gray-100 dark:bg-neutral-900">
      <div class="container">
        <div class="row justify-center">
          <div class="md:col-8 lg:col-7 text-center">
            <h2 class="mb-8">Experience</h2>
            <ul class="list-none">
              {{ range . }}
                {{ $item := . }}
                <li class="flex items-center justify-center mb-6">

                  {{/* Light logo (default in light mode) */}}
                  {{ with (index $item.logo "light") }}
                    {{ partial "image" (dict
                      "Src"   .
                      "Alt"   (printf "%s Logo" $item.title)
                      "Class" "w-12 h-12 mr-5 block dark:hidden"
                    ) }}
                  {{ end }}

                  {{/* Dark logo (shown only in dark mode) */}}
                  {{ with (index $item.logo "dark") }}
                    {{ partial "image" (dict
                      "Src"   .
                      "Alt"   (printf "%s Dark Logo" $item.title)
                      "Class" "w-12 h-12 mr-5 hidden dark:block"
                    ) }}
                  {{ end }}

                  <div class="text-left">
                    <h3 class="text-xl font-semibold">{{ $item.title }}</h3>
                    <p class="text-base text-gray-500">{{ $item.organization }}</p>
                    <p class="text-sm text-gray-400">{{ $item.duration }}</p>
                  </div>
                </li>
              {{ end }}
            </ul>
          </div>
        </div>
      </div>
    </section>
  {{ end }}

  <!-- Videos Section -->
  {{ with .Params.videos }}
    <section class="section-sm bg-gray-50 dark:bg-neutral-900">
      <div class="container">
        <div class="row justify-center">
          <div class="md:col-10 lg:col-8 text-center">
            <h2 class="mb-8">Videos</h2>
            <div class="video-grid grid gap-6 md:grid-cols-2 lg:grid-cols-3">
              {{ range . }}
                <div class="video-card bg-white dark:bg-neutral-800 rounded-lg shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
                  <a href="{{ .link }}" target="_blank" rel="noopener" class="block relative group">
                    <div class="video-thumbnail relative aspect-video bg-gray-200 dark:bg-gray-700">
                      {{ $thumbnailExists := false }}
                      {{ if .thumbnail }}
                        {{ $thumbnailResource := resources.Get .thumbnail }}
                        {{ if $thumbnailResource }}
                          {{ $thumbnailExists = true }}
                          <img src="{{ $thumbnailResource.Permalink }}" alt="{{ .title }} thumbnail" class="w-full h-full object-cover">
                        {{ end }}
                      {{ end }}
                      {{ if not $thumbnailExists }}
                        <div class="w-full h-full flex flex-col items-center justify-center bg-gradient-to-br from-primary/20 to-primary/40">
                          <i class="fas fa-play-circle text-4xl text-primary mb-2"></i>
                          <span class="text-primary font-medium text-sm">{{ .platform }} Video</span>
                        </div>
                      {{ end }}
                      <!-- Play button overlay -->
                      <div class="video-play-overlay absolute inset-0 flex items-center justify-center bg-black/30 opacity-0 group-hover:opacity-100 transition-opacity duration-300">
                        <div class="bg-white/90 rounded-full w-10 h-10 flex items-center justify-center">
                          <i class="fas fa-play text-primary text-xl ml-1"></i>
                        </div>
                      </div>
                      <!-- Platform badge -->
                      <div class="absolute top-2 right-2">
                        <span class="video-platform-badge px-2 py-1 bg-black/70 text-white text-xs rounded-full">
                          {{ if eq .platform "YouTube" }}
                            <i class="fab fa-youtube mr-1"></i>
                          {{ else if eq .platform "Bilibili" }}
                            <i class="fas fa-video mr-1"></i>
                          {{ end }}
                          {{ .platform }}
                        </span>
                      </div>
                    </div>
                    <div class="p-4">
                      <h3 class="text-lg font-semibold mb-2 text-gray-900 dark:text-gray-100 transition-colors duration-300">
                        {{ .title }}
                      </h3>
                      <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">
                        {{ .description }}
                      </p>
                      <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-500">
                        <span>{{ .year }}</span>
                        {{ if .language }}
                          <span class="bg-gray-100 dark:bg-gray-700 px-2 py-1 rounded">{{ .language }}</span>
                        {{ end }}
                      </div>
                    </div>
                  </a>
                </div>
              {{ end }}
            </div>
          </div>
        </div>
      </div>
    </section>
  {{ end }}
  <!-- /Videos Section -->

  {{ with .Params.publications }}
    <section class="section-sm">
      <div class="container">
        <div class="row justify-center">
          <div class="md:col-8 lg:col-7 text-center">
            <h2 class="mb-8">Selected Publications</h2>
            <ul class="list-none">
              {{ range $i, $item := . }}
                {{ $citeID := printf "cite-box-%d" $i }}
                <li class="mb-6 text-left">
                  <h3 class="text-xl font-semibold">{{ $item.title }}</h3>

                  <p class="text-base text-black-300">
                    {{ range $idx, $author := $item.authors }}
                      {{ if $idx }}, {{ end }}{{ $author | markdownify }}
                    {{ end }}
                  </p>

                  <p class="text-base text-gray-400">{{ $item.paper_info }}</p>

                  <div class="mt-4 flex flex-wrap gap-3">
                    {{ with $item.pdf_link }}
                      <a href="{{ . }}" class="btn btn-primary" target="_blank" rel="noopener">PDF</a>
                    {{ end }}

                    <!-- Cite button toggles visibility -->
                    <button type="button" class="btn btn-secondary" data-toggle-cite="{{ $citeID }}">
                      Cite
                    </button>

                    {{ with $item.doi_link }}
                      <a href="{{ . }}" class="btn btn-secondary" target="_blank" rel="noopener">DOI</a>
                    {{ end }}

                    {{ with $item.code_link }}
                      <a href="{{ . }}" class="btn btn-secondary" target="_blank" rel="noopener">Code</a>
                    {{ end }}
                  </div>

                  <!-- Hidden Cite Box -->
                  <div id="{{ $citeID }}" class="hidden mt-4 rounded-lg border border-gray-200 bg-gray-50 p-4 dark:border-gray-700 dark:bg-gray-800">
                    <pre class="overflow-auto text-sm leading-6"><code data-cite-text>
  {{- with $item.bibtex -}}
  {{ . -}}
  {{- else -}}
  No BibTeX provided.{{ with $item.cite_link }} Visit: {{ . }}{{ end }}
  {{- end -}}
                    </code></pre>
                    <div class="mt-3 flex gap-3">
                      <button class="btn btn-primary" data-copy-cite>Copy</button>
                      <button class="btn btn-secondary" data-download-cite>Download</button>
                    </div>
                  </div>
                </li>
              {{ end }}
            </ul>
            <!-- General button for all publications -->
            <div class="mt-8">
              <a href="{{ "/elements" | relURL }}" class="btn btn-primary">View All Publications</a>
            </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Minimal JS -->
    <script>
      (function () {
        function getCiteText(btn) {
          const box = btn.closest('[id^="cite-box-"]');
          const code = box && box.querySelector('code[data-cite-text]');
          return code ? code.textContent : '';
        }
        document.addEventListener('click', async (e) => {
          // Toggle cite box
          const toggle = e.target.closest('[data-toggle-cite]');
          if (toggle) {
            e.preventDefault();
            const box = document.getElementById(toggle.getAttribute('data-toggle-cite'));
            if (box) box.classList.toggle('hidden');
            return;
          }
          // Copy
          if (e.target.closest('[data-copy-cite]')) {
            const text = getCiteText(e.target).trim();
            try {
              await navigator.clipboard.writeText(text);
              e.target.textContent = 'Copied!';
              setTimeout(() => (e.target.textContent = 'Copy'), 1200);
            } catch {}
            return;
          }
          // Download
          if (e.target.closest('[data-download-cite]')) {
            const text = getCiteText(e.target).trim();
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'citation.bib';
            document.body.appendChild(a);
            a.click();
            a.remove();
            URL.revokeObjectURL(url);
            return;
          }
        });
      })();
    </script>
  {{ end }}
  <!-- /Experience Section -->
{{ end }}
